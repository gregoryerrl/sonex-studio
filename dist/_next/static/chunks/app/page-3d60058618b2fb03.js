(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9773:function(e,t,r){Promise.resolve().then(r.bind(r,8836))},8836:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var n=r(3827),l=r(4090),a=r(6431),u=r(5425),c=r(9528),i=r(2447);function s(){let[e,t]=(0,l.useState)(null),[r,s]=(0,l.useState)(!1),[o,d]=(0,l.useState)([]),[m,g]=(0,l.useState)(0),[h,f]=(0,l.useState)(1),[x,b]=(0,l.useState)(!1),[p,w]=(0,l.useState)(!1),[y,v]=(0,l.useState)(null),[j,N]=(0,l.useState)(null),[C,M]=(0,l.useState)(!0),[R,S]=(0,l.useState)(.8),T=(0,l.useRef)(null),k=(0,l.useRef)(null),E=(0,l.useRef)(null),D=(0,l.useRef)(void 0),F=(0,l.useRef)(null),A=(0,l.useRef)(0),L=(0,l.useRef)(0),B=(0,l.useRef)(0),X=(0,l.useRef)(!1),[P,_]=(0,l.useState)(0),q=(0,l.useRef)(null),Z=(0,l.useRef)(0),O=(0,l.useRef)(null),G=async e=>{let t=new AudioContext,r=await e.arrayBuffer(),n=await t.decodeAudioData(r),l=n.getChannelData(0),a=n.duration,u=Math.ceil(2*a);console.log("Audio duration: ".concat(a,"s, Samples: ").concat(u));let c=Math.floor(l.length/u),i=[];for(let e=0;e<u;e++){let t=1/0,r=-1/0;for(let n=0;n<c;n++){let a=l[e*c+n];a<t&&(t=a),a>r&&(r=a)}i.push(r),i.push(t)}let s=Math.max(...i.map(Math.abs));d(i.map(e=>e/s)),T.current&&g(-T.current.getBoundingClientRect().width/2)},U=()=>{let e=T.current;if(!e)return;let t=e.getContext("2d");if(!t)return;let r=e.getBoundingClientRect(),n=r.width,l=r.height,a=window.devicePixelRatio||1;e.width=n*a,e.height=l*a,t.scale(a,a),t.clearRect(0,0,n,l);let u=6*R,c=u+1*R,i=Math.ceil(n/c)+2,s=Math.max(0,2*Math.floor((m-c)/c)),d=Math.min(s+(i+2)*2,o.length),g=t.createLinearGradient(0,0,0,l);g.addColorStop(0,"rgb(64, 192, 255)"),g.addColorStop(1,"rgb(32, 128, 255)"),t.fillStyle=g;for(let e=s;e<d;e+=2){let r=o[e],n=o[e+1],a=e/2*c-m,i=Math.max(Math.abs(r),Math.abs(n))*l*.8,s=l/2;t.fillRect(a,s-i/2,u,i)}if(null!==y&&E.current){let e=E.current.getDuration(),r=o.length/2*c,n=y/e*r-m;if(t.fillStyle="rgb(255, 128, 0)",t.fillRect(n-1,0,2,l),null!==j){let a=j/e*r-m;t.fillStyle="rgba(255, 128, 0, 0.2)",t.fillRect(n,0,a-n,l),t.fillStyle="rgb(255, 128, 0)",t.fillRect(a-1,0,2,l)}}t.fillStyle="rgb(255, 255, 255)";let h=n/2;t.fillRect(h-1,0,2,l),t.beginPath(),t.moveTo(h-8,0),t.lineTo(h+8,0),t.lineTo(h,8),t.closePath(),t.fill()},W=()=>{if(!E.current||!r||!T.current)return;let e=E.current.getCurrentTime(),t=E.current.getDuration();null!==y&&null!==j?e>=j&&(C?(E.current.setTime(y),requestAnimationFrame(()=>{E.current&&r&&E.current.play()})):(E.current.pause(),s(!1),U())):e>=t&&(C?(E.current.setTime(0),requestAnimationFrame(()=>{E.current&&r&&E.current.play()})):(E.current.pause(),s(!1),U()));let n=7*R,l=o.length/2*n,a=T.current.getBoundingClientRect().width;g(Math.max(-a/2,Math.min(e/t*l-a/2,l-a/2))),D.current=requestAnimationFrame(W)};(0,l.useEffect)(()=>{o.length>0&&U()},[o,m,y,j,R]),(0,l.useEffect)(()=>(r?D.current=requestAnimationFrame(W):D.current&&cancelAnimationFrame(D.current),()=>{D.current&&cancelAnimationFrame(D.current)}),[r]);let z=async e=>{var r,n;let l=null===(r=e.target.files)||void 0===r?void 0:r[0];if(!l)return;t(l),await G(l),null===(n=E.current)||void 0===n||n.destroy();let u=a.Z.create({container:document.createElement("div"),height:0});try{await u.loadBlob(l),E.current=u,u.on("play",()=>s(!0)),u.on("pause",()=>s(!1)),u.on("finish",()=>{if(s(!1),T.current){let e=7*R,t=o.length/2*e,r=T.current.getBoundingClientRect().width;g(t-r/2),U()}})}catch(e){console.error("Error loading audio file:",e),u.destroy()}},H=e=>{var t;let r="reset"===e?1:"inc"===e?Math.min(2,Number((h+.1).toFixed(1))):Math.max(.5,Number((h-.1).toFixed(1)));f(r),null===(t=E.current)||void 0===t||t.setPlaybackRate(r)},I=()=>{F.current&&clearTimeout(F.current),b(!1),X.current&&p&&E.current&&E.current.play()},J=()=>{F.current&&clearTimeout(F.current),b(!1),X.current&&p&&E.current&&E.current.play()},K=(0,l.useCallback)((e,t)=>{if(!E.current)return;let r=E.current.getCurrentTime(),n=R<1?.4:.3,l=(e-r)*n,a=(t-m)*n,u=R<1?.01:.005,c=R<1?1:.5;if(Math.abs(l)<u&&Math.abs(a)<c){E.current.setTime(e),g(t),O.current=null;return}E.current.setTime(r+l),g(m+a),(Math.abs(e-r)>.01||Math.abs(t-m)>1)&&(O.current=requestAnimationFrame(()=>K(e,t)))},[m,R]);(0,l.useEffect)(()=>{let e=e=>{if(!x||!E.current||!T.current)return;e.preventDefault(),X.current=!0;let t=R<1?24:16,r=performance.now();if(r-P<t)return;_(r);let n=T.current.getBoundingClientRect(),l=7*R,a=o.length/2*l,u=n.width,c=e.clientX-Z.current;Z.current=e.clientX;let i=Math.max(-u/2,Math.min(m-c,a-u/2)),s=i+u/2,d=E.current.getDuration(),h=E.current.getCurrentTime(),f=Math.max(0,Math.min(s/a*d,d));O.current&&(cancelAnimationFrame(O.current),O.current=null);let b=window.innerWidth<=768?R<1?.1:.02:R<1?.2:.05;Math.abs(f-h)>b||Math.abs(i-m)>b?K(f,i):(E.current.setTime(f),g(i))},t=t=>{x&&E.current&&T.current&&(t.preventDefault(),e({clientX:t.touches[0].clientX,preventDefault:()=>t.preventDefault()}))},r=()=>{O.current&&cancelAnimationFrame(O.current),q.current=null};return window.addEventListener("touchend",J),window.addEventListener("touchcancel",J),window.addEventListener("touchmove",t,{passive:!1}),window.addEventListener("mouseup",I),window.addEventListener("mousemove",e),()=>{r(),window.removeEventListener("touchend",J),window.removeEventListener("touchcancel",J),window.removeEventListener("touchmove",t),window.removeEventListener("mouseup",I),window.removeEventListener("mousemove",e)}},[x,o.length,R,P,K]),(0,l.useEffect)(()=>()=>{O.current&&cancelAnimationFrame(O.current)},[]);let Q=e=>{if(E.current)switch(e){case"start":v(E.current.getCurrentTime()),null!==j&&j<E.current.getCurrentTime()&&N(null),U();break;case"end":{let e=E.current.getCurrentTime();(null===y||e>y)&&(N(e),r&&E.current.pause(),U());break}case"clear":v(null),N(null),U()}};return(0,n.jsxs)("div",{className:"min-h-screen bg-gray-900 text-gray-100 p-2 md:p-4",children:[(0,n.jsx)("h1",{className:"text-xl md:text-2xl font-bold mb-4 text-blue-400",children:"Sonex-Studio Prototype"}),(0,n.jsxs)("div",{className:"space-y-3 md:space-y-4",children:[(0,n.jsx)("input",{type:"file",accept:".mp3,.wav,.m4a,.aac,.ogg,.flac",onChange:z,className:"block w-full text-sm text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-900 file:text-blue-300 hover:file:bg-blue-800"}),(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-2 justify-center md:justify-start",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>H("dec"),className:"w-10 h-10 bg-gray-800 text-gray-300 rounded-full hover:bg-gray-700 flex items-center justify-center text-lg disabled:opacity-50 disabled:cursor-not-allowed",disabled:!e,children:"-"}),(0,n.jsxs)("span",{className:"w-16 text-center font-mono text-sm text-gray-300",children:[h.toFixed(1),"x"]}),(0,n.jsx)("button",{onClick:()=>H("inc"),className:"w-10 h-10 bg-gray-800 text-gray-300 rounded-full hover:bg-gray-700 flex items-center justify-center text-lg disabled:opacity-50 disabled:cursor-not-allowed",disabled:!e,children:"+"}),(0,n.jsx)("button",{onClick:()=>H("reset"),className:"px-3 py-2 bg-gray-800 text-gray-300 rounded hover:bg-gray-700 text-sm disabled:opacity-50 disabled:cursor-not-allowed",disabled:!e,children:"Reset"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>Q("clear"),className:"px-3 py-2 bg-orange-700 text-gray-200 rounded hover:bg-orange-600 text-sm",children:"Clear Region"}),(0,n.jsxs)("label",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:C,onChange:e=>{r&&E.current&&E.current.pause(),M(e.target.checked)},className:"w-4 h-4 text-blue-500 bg-gray-800 rounded focus:ring-blue-500 focus:ring-offset-gray-900"}),(0,n.jsx)("span",{className:"text-sm text-gray-300",children:"Loop"})]})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 w-full max-w-sm mx-auto md:mx-0",children:[(0,n.jsx)("span",{className:"text-sm text-gray-300 min-w-[3rem]",children:"Zoom:"}),(0,n.jsx)("input",{type:"range",min:"0.2",max:"2",step:"0.1",value:R,onChange:e=>{if(!T.current||!E.current)return;let t=parseFloat(e.target.value),r=T.current.getBoundingClientRect().width,n=E.current.getCurrentTime(),l=E.current.getDuration(),a=7*t,u=o.length*a;S(t),g(Math.max(-r/2,Math.min(n/l*u-r/2,u-r/2)))},className:"flex-grow h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"}),(0,n.jsxs)("span",{className:"text-sm text-gray-300 min-w-[3rem] text-right",children:[(R/.8).toFixed(1),"x"]})]}),(0,n.jsx)("div",{ref:k,className:"relative",children:(0,n.jsx)("canvas",{ref:T,className:"w-full h-[120px] bg-gray-800 rounded-lg cursor-pointer select-none touch-none",onMouseDown:e=>{E.current&&T.current&&(w(r),r&&E.current.pause(),b(!0),B.current=Date.now(),X.current=!1,A.current=e.clientX,Z.current=e.clientX,L.current=E.current.getCurrentTime()/E.current.getDuration())},onTouchStart:e=>{E.current&&T.current&&(w(r),r&&E.current.pause(),b(!0),B.current=Date.now(),X.current=!1,A.current=e.touches[0].clientX,Z.current=e.touches[0].clientX,L.current=E.current.getCurrentTime()/E.current.getDuration())}})}),(0,n.jsx)("div",{className:"flex items-center gap-2",children:e&&(0,n.jsxs)("div",{className:"flex flex-col justify-center items-center gap-2 w-full",children:[(0,n.jsxs)("div",{className:"flex w-full justify-center items-center gap-3",children:[(0,n.jsx)("button",{onClick:()=>{if(!E.current||!T.current)return;let e=null!==y?y:0;E.current.setTime(e);let t=7*R,r=o.length*t,n=T.current.getBoundingClientRect().width;g(Math.max(-n/2,Math.min(e/E.current.getDuration()*r-n/2,r-n/2))),E.current.play()},className:"p-3 bg-blue-700 text-gray-200 rounded-full hover:bg-blue-600",children:(0,n.jsx)(u.Z,{className:"w-5 h-5"})}),(0,n.jsx)("button",{onClick:()=>Q("start"),className:"p-3 bg-orange-700 text-gray-200 rounded-full hover:bg-orange-600 text-lg font-bold",children:"["}),(0,n.jsx)("button",{onClick:()=>Q("end"),className:"p-3 bg-orange-700 text-gray-200 rounded-full hover:bg-orange-600 text-lg font-bold",children:"]"}),(0,n.jsx)("button",{onClick:()=>{E.current&&(r||null===y||E.current.setTime(y),r?(E.current.pause(),s(!1)):(E.current.play(),s(!0)))},className:"p-4 bg-blue-700 text-gray-200 rounded-full hover:bg-blue-600",children:r?(0,n.jsx)(c.Z,{className:"w-6 h-6"}):(0,n.jsx)(i.Z,{className:"w-6 h-6"})})]}),(0,n.jsx)("div",{className:"text-xs md:text-sm text-gray-400",children:"Use [ and ] to set loop region points"})]})})]})]})}}},function(e){e.O(0,[438,971,69,744],function(){return e(e.s=9773)}),_N_E=e.O()}]);